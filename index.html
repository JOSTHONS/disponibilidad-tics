<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DisponibilidadTICÂ´S - GestiÃ³n de Espacios</title>
    
    <!-- ðŸŸ¢ META TAGS PARA COMPARTIR (WHATSAPP/TEAMS) -->
    <meta name="description" content="AplicaciÃ³n oficial para la gestiÃ³n y consulta de espacios en tiempo real. UTNG.">
    <meta property="og:title" content="DisponibilidadTICÂ´S - Enterprise">
    <meta property="og:description" content="Consulta la disponibilidad de laboratorios y aulas al instante. Descarga segura.">
    <meta property="og:image" content="./assets/logo.png">
    
    <!-- ðŸŸ¢ FAVICON (EL LOGUITO EN LA PESTAÃ‘A) -->
    <link rel="icon" type="image/png" href="./assets/logo.png">

    <!-- CONEXIÃ“N CON EL CSS -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- ESTILOS EXTRA PARA LAS SECCIONES CORPORATIVAS -->
    <style>
        /* Grid de Beneficios */
        .features-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1.5rem; margin-top: 1rem; }
        .feature-card { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); padding: 1.5rem; border-radius: 20px; text-align: left; transition: 0.3s; position: relative; overflow: hidden; }
        .feature-card:hover { border-color: #00ffa3; transform: translateY(-5px); background: rgba(255,255,255,0.05); }
        .feature-icon { color: #00ffa3; margin-bottom: 1rem; background: rgba(0, 255, 163, 0.1); width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; }
        .feature-title { font-weight: 700; margin-bottom: 0.5rem; color: #fff; font-size: 1.1rem; }
        .feature-desc { font-size: 0.9rem; color: #9ca3af; line-height: 1.5; }

        /* AcordeÃ³n FAQ Profesional */
        .faq-container { display: flex; flex-direction: column; gap: 10px; }
        details { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05); border-radius: 15px; overflow: hidden; transition: 0.3s; }
        details[open] { border-color: #00d4ff; background: rgba(0, 212, 255, 0.05); }
        summary { padding: 18px; cursor: pointer; font-weight: 600; color: #fff; list-style: none; display: flex; justify-content: space-between; align-items: center; }
        summary::-webkit-details-marker { display: none; }
        summary::after { content: '+'; font-size: 1.2rem; color: #00d4ff; transition: 0.3s; }
        details[open] summary::after { transform: rotate(45deg); }
        .faq-answer { padding: 0 18px 18px 18px; color: #d1d5db; font-size: 0.95rem; line-height: 1.6; border-top: 1px solid rgba(255,255,255,0.05); margin-top: 0; padding-top: 15px; }

        /* Footer Corporativo */
        .footer { text-align: center; padding: 3rem 1rem; border-top: 1px solid rgba(255,255,255,0.1); margin-top: 3rem; background: rgba(0,0,0,0.2); }
        .footer-logo { width: 30px; height: 30px; border-radius: 6px; margin-bottom: 10px; opacity: 0.8; }
        .footer-text { color: #6b7280; font-size: 0.85rem; margin-bottom: 1rem; }
        .footer-links { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; }
        .footer a { color: #9ca3af; text-decoration: none; font-size: 0.85rem; transition: 0.2s; }
        .footer a:hover { color: #00ffa3; }
        .verified-badge { display: inline-flex; align-items: center; gap: 5px; color: #00ffa3; font-size: 0.8rem; background: rgba(0, 255, 163, 0.1); padding: 4px 10px; border-radius: 20px; margin-bottom: 1rem; border: 1px solid rgba(0, 255, 163, 0.2); }
    </style>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { 
            getFirestore, collection, addDoc, onSnapshot, query, orderBy, 
            doc, updateDoc, increment, getDoc, setDoc, deleteDoc 
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // ðŸ”´ TUS LLAVES REALES
        const firebaseConfig = {
            apiKey: "AIzaSyDgvKfJS6w0j7h-x7oe9NYKSVDUNx0YPok",
            authDomain: "spacefinder-web.firebaseapp.com",
            projectId: "spacefinder-web",
            storageBucket: "spacefinder-web.firebasestorage.app",
            messagingSenderId: "731767762070",
            appId: "1:731767762070:web:3a4ded7e5e42fff9d526b7"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Exponer funciones globales
        window.db = db;
        window.collection = collection;
        window.addDoc = addDoc;
        window.onSnapshot = onSnapshot;
        window.query = query;
        window.orderBy = orderBy;
        window.doc = doc;
        window.updateDoc = updateDoc;
        window.increment = increment;
        window.getDoc = getDoc;
        window.setDoc = setDoc;
        window.deleteDoc = deleteDoc;
    </script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- ICONOS SVG ---
        // ðŸŸ¢ FIX: Se agregÃ³ 'className' para que el icono reciba estilos
        const StarIcon = ({ fill, size = 20, className }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill={fill || "none"} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
        );
        // ðŸŸ¢ FIX: Se agregÃ³ 'className' al ShareIcon
        const ShareIcon = ({ size = 20, className }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
        );
        const ShieldIcon = ({ size = 20, className }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
        );
        const DownloadIcon = ({ size = 20, className }) => (
             <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
        );
        const TrashIcon = ({ size = 16, onClick }) => (
            <svg style={{cursor:'pointer'}} onClick={onClick} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>
        );
        const CloseIcon = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
        );
        // Iconos nuevos para Features
        const BoltIcon = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>;
        const LockIcon = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>;
        const CheckIcon = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="20 6 9 17 4 12"/></svg>;

        // --- COMPONENTE PRINCIPAL ---
        const App = () => {
            const [isInstalling, setIsInstalling] = React.useState(false);
            const [installed, setInstalled] = React.useState(false);
            const [reviews, setReviews] = React.useState([]);
            const [downloadCount, setDownloadCount] = React.useState(0);
            const [averageRating, setAverageRating] = React.useState(0);
            const [totalRatings, setTotalRatings] = React.useState(0);
            const [showReviewForm, setShowReviewForm] = React.useState(false);
            const [newReview, setNewReview] = React.useState({ name: '', text: '', rating: 5 });
            const [selectedImage, setSelectedImage] = React.useState(null);

            const screenshots = ['screen1.jpeg', 'screen2.jpeg', 'screen3.jpeg', 'screen4.jpeg', 'screen5.jpeg'];

            // ðŸŸ¢ FUNCIÃ“N PARA COMPARTIR
            const handleShare = async () => {
                const shareData = {
                    title: 'DisponibilidadTICÂ´S',
                    text: 'Consulta la disponibilidad de espacios en la UTNG. Descarga la App aquÃ­:',
                    url: window.location.href
                };

                try {
                    if (navigator.share) {
                        await navigator.share(shareData);
                    } else {
                        // Fallback para PC o navegadores antiguos
                        await navigator.clipboard.writeText(window.location.href);
                        alert('Â¡Enlace copiado al portapapeles!');
                    }
                } catch (err) {
                    console.error('Error al compartir:', err);
                }
            };

            React.useEffect(() => {
                if (!window.db) return;
                const qReviews = window.query(window.collection(window.db, "reviews"), window.orderBy("timestamp", "desc"));
                const unsubReviews = window.onSnapshot(qReviews, (snapshot) => {
                    const reviewsData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    setReviews(reviewsData);
                    if (reviewsData.length > 0) {
                        const totalStars = reviewsData.reduce((acc, curr) => acc + curr.rating, 0);
                        setAverageRating((totalStars / reviewsData.length).toFixed(1));
                        setTotalRatings(reviewsData.length);
                    }
                });
                const statsRef = window.doc(window.db, "app_stats", "general");
                const unsubStats = window.onSnapshot(statsRef, (doc) => {
                    if (doc.exists()) setDownloadCount(doc.data().downloadCount || 0);
                    else window.setDoc(statsRef, { downloadCount: 0 });
                });
                return () => { unsubReviews(); unsubStats(); };
            }, []);

            const handleDownload = async () => {
                setIsInstalling(true);
                try {
                    const statsRef = window.doc(window.db, "app_stats", "general");
                    await window.updateDoc(statsRef, { downloadCount: window.increment(1) });
                    setTimeout(() => {
                        setIsInstalling(false);
                        setInstalled(true);
                        const link = document.createElement('a');
                        link.href = './assets/app-release.apk'; 
                        link.download = 'DisponibilidadTICS.apk';
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                    }, 1500);
                } catch (error) {
                    setIsInstalling(false);
                    const link = document.createElement('a');
                    link.href = './assets/app-release.apk'; 
                    link.download = 'DisponibilidadTICS.apk';
                    link.click();
                }
            };

            const handleDeleteReview = async (reviewId) => {
                const password = prompt("ðŸ”’ ContraseÃ±a de administrador:");
                if (password === "admin123") {
                    try { await window.deleteDoc(window.doc(window.db, "reviews", reviewId)); } 
                    catch (error) { alert("Error: " + error.message); }
                } else if (password !== null) { alert("â›” Incorrecto."); }
            };

            const handleSubmitReview = async (e) => {
                e.preventDefault();
                if (!newReview.name || !newReview.text) return;
                try {
                    await window.addDoc(window.collection(window.db, "reviews"), {
                        user: newReview.name, text: newReview.text, rating: newReview.rating,
                        date: new Date().toLocaleDateString('es-ES'),
                        avatar: newReview.name.substring(0, 2).toUpperCase(), timestamp: Date.now()
                    });
                    setNewReview({ name: '', text: '', rating: 5 });
                    setShowReviewForm(false);
                } catch (error) { alert("Error: " + error.message); }
            };

            return (
                <div className="container">
                    {/* LIGHTBOX ZOOM */}
                    {selectedImage && (
                        <div className="lightbox-overlay" onClick={() => setSelectedImage(null)}>
                            <button className="close-btn" onClick={() => setSelectedImage(null)}><CloseIcon /></button>
                            <img src={`./assets/screenshots/${selectedImage}`} className="lightbox-img" onClick={e => e.stopPropagation()} />
                        </div>
                    )}

                    {/* NAVBAR */}
                    <nav className="navbar">
                        <div className="brand">
                            <img src="./assets/logo.png" className="brand-logo-sm" alt="logo"/>
                            <span className="brand-name">DisponibilidadTICÂ´S</span>
                        </div>
                        {/* ðŸŸ¢ BOTÃ“N COMPARTIR FUNCIONAL (COLOR FIX) */}
                        <button onClick={handleShare} style={{background: 'transparent', border: 'none', cursor: 'pointer', padding: '5px', color: '#fff'}}>
                            <ShareIcon className="text-white" />
                        </button>
                    </nav>

                    <main className="animate-enter">
                        {/* HERO */}
                        <section className="hero">
                            <div className="hero-header">
                                <img src="./assets/logo.png" className="app-icon-large" />
                                <div className="hero-info">
                                    <div className="verified-badge"><CheckIcon width="14" /> App Institucional Oficial</div>
                                    <h1>DisponibilidadTICÂ´S</h1>
                                    <div className="developer-name">Facultad de IngenierÃ­a - UTNG</div> 
                                    <div className="badges">
                                        <span className="badge">V 2.0.1</span>
                                        <span className="badge">Enterprise</span>
                                    </div>
                                </div>
                            </div>

                            {/* STATS */}
                            <div className="stats-grid">
                                <div className="stat-item">
                                    <div className="stat-value">{averageRating || "5.0"} <StarIcon size={14} fill="currentColor" /></div>
                                    <span className="stat-label">Calidad</span>
                                </div>
                                <div className="stat-item">
                                    <div className="stat-value" key={downloadCount} style={{animation: 'pulseGreen 0.3s'}}>
                                        {downloadCount.toLocaleString()}
                                    </div>
                                    <span className="stat-label">Usuarios Activos</span>
                                </div>
                                <div className="stat-item">
                                    <div className="stat-value"><ShieldIcon size={18} /></div>
                                    <span className="stat-label">Verificado</span>
                                </div>
                            </div>

                            <div className="py-6 w-full hidden-mobile">
                                <button onClick={handleDownload} disabled={isInstalling} className={`btn-install ${installed ? 'btn-secondary' : 'btn-primary'}`}>
                                    {/* ðŸŸ¢ TEXTO ACTUALIZADO */}
                                    {installed ? (<><span>âœ“</span> Listo para usar</>) : (isInstalling ? 'Descargando...' : 'Descargar')}
                                </button>
                            </div>
                        </section>

                        {/* ðŸŸ¢ SECCIÃ“N NUEVA: BENEFICIOS CORPORATIVOS */}
                        <section className="section">
                            <h2 className="section-title">CaracterÃ­sticas Enterprise</h2>
                            <div className="features-grid">
                                <div className="feature-card">
                                    <div className="feature-icon"><BoltIcon /></div>
                                    <h3 className="feature-title">Tiempo Real</h3>
                                    <p className="feature-desc">SincronizaciÃ³n instantÃ¡nea con la base de datos central de la UTNG para evitar conflictos de horario.</p>
                                </div>
                                <div className="feature-card">
                                    <div className="feature-icon"><LockIcon /></div>
                                    <h3 className="feature-title">Seguridad Institucional</h3>
                                    <p className="feature-desc">Protocolos de encriptaciÃ³n de grado militar para proteger la informaciÃ³n de alumnos y docentes.</p>
                                </div>
                                <div className="feature-card">
                                    <div className="feature-icon"><CheckIcon /></div>
                                    <h3 className="feature-title">Alta Disponibilidad</h3>
                                    <p className="feature-desc">Infraestructura escalable diseÃ±ada para soportar alta demanda durante periodos de exÃ¡menes.</p>
                                </div>
                            </div>
                        </section>

                        {/* SCREENSHOTS */}
                        <section className="section">
                            <h2 className="section-title">Interfaz de Usuario</h2>
                            <div className="screenshots-container">
                                {screenshots.map((imgName, i) => (
                                    <div key={i} className="screenshot-card" onClick={() => setSelectedImage(imgName)}>
                                        <img src={`./assets/screenshots/${imgName}`} className="screenshot-img" 
                                            onError={(e) => { e.target.style.display='none'; e.target.parentNode.style.background='#333'; }} 
                                        />
                                    </div>
                                ))}
                            </div>
                        </section>

                        {/* DEMO VIDEO */}
                        <section className="section">
                            <h2 className="section-title">DemostraciÃ³n</h2>
                            <div className="video-section-container">
                                <div className="mobile-video-frame">
                                    <iframe className="mobile-video" width="100%" height="100%" 
                                        src="https://www.youtube.com/embed/dQS_hPHYwmw?rel=0&modestbranding=1&playsinline=1&controls=1&loop=1&playlist=dQS_hPHYwmw" 
                                        title="Demo App" frameBorder="0" allowFullScreen
                                    ></iframe>
                                </div>
                            </div>
                        </section>

                        {/* ðŸŸ¢ SECCIÃ“N NUEVA: FAQ (PREGUNTAS FRECUENTES) */}
                        <section className="section">
                            <h2 className="section-title">Preguntas Frecuentes</h2>
                            <div className="faq-container">
                                <details>
                                    <summary>Â¿Se requiere conexiÃ³n a internet?</summary>
                                    <div className="faq-answer">SÃ­, para garantizar la integridad de los datos en tiempo real y evitar duplicidad en las reservas, se requiere una conexiÃ³n activa (Wi-Fi UTNG o Datos).</div>
                                </details>
                                <details>
                                    <summary>Â¿Es seguro descargar el APK?</summary>
                                    <div className="faq-answer">Absolutamente. Este archivo ha sido firmado digitalmente por el departamento de desarrollo de la UTNG y estÃ¡ libre de malware.</div>
                                </details>
                                <details>
                                    <summary>Â¿QuÃ© requisitos tiene?</summary>
                                    <div className="faq-answer">Android 8.0 o superior. Optimizado para funcionar en dispositivos de gama media y alta con mÃ­nimo consumo de baterÃ­a.</div>
                                </details>
                            </div>
                        </section>

                        {/* REVIEWS */}
                        <section className="section">
                            <div className="section-title">
                                Testimonios
                                <button onClick={() => setShowReviewForm(!showReviewForm)} className="btn-action">
                                    {showReviewForm ? 'Cerrar' : 'Agregar'}
                                </button>
                            </div>

                            {showReviewForm && (
                                <div className="review-form-card">
                                    <form onSubmit={handleSubmitReview}>
                                        <div className="stars-selector">
                                            {[1,2,3,4,5].map((star) => (
                                                <button key={star} type="button" onClick={() => setNewReview({...newReview, rating: star})}>
                                                    <StarIcon size={32} fill={star <= newReview.rating ? "#00ffa3" : "none"} className={star <= newReview.rating ? '' : 'text-gray-500'} />
                                                </button>
                                            ))}
                                        </div>
                                        <input type="text" placeholder="Nombre completo" className="input-field" value={newReview.name} onChange={e => setNewReview({...newReview, name: e.target.value})} required />
                                        <textarea placeholder="Comentarios sobre el rendimiento..." className="input-field" style={{height: '100px', resize: 'none'}} value={newReview.text} onChange={e => setNewReview({...newReview, text: e.target.value})} required></textarea>
                                        <button type="submit" className="btn-install btn-primary">Enviar Feedback</button>
                                    </form>
                                </div>
                            )}

                            <div className="review-list">
                                {reviews.length === 0 ? (
                                    <div style={{textAlign: 'center', color: '#9ca3af', padding: '2rem'}}>Sin reseÃ±as aÃºn.</div>
                                ) : (
                                    reviews.map((review) => (
                                        <div key={review.id} className="review-item">
                                            <div className="avatar">{review.avatar}</div>
                                            <div className="review-content">
                                                <div className="review-header">
                                                    <span className="reviewer-name">{review.user}</span>
                                                    <TrashIcon size={16} onClick={() => handleDeleteReview(review.id)} />
                                                </div>
                                                <div className="review-meta">
                                                    <div style={{display:'flex', color: '#00ffa3'}}>
                                                        {[...Array(5)].map((_, i) => (
                                                            <StarIcon key={i} size={12} fill={i < review.rating ? "currentColor" : "none"} stroke={i < review.rating ? "currentColor" : "#4b5563"} />
                                                        ))}
                                                    </div>
                                                    <span style={{fontSize: '0.75rem', color: '#9ca3af'}}>{review.date}</span>
                                                </div>
                                                <p className="review-text">{review.text}</p>
                                            </div>
                                        </div>
                                    ))
                                )}
                            </div>
                        </section>
                    </main>
                    
                    {/* ðŸŸ¢ FOOTER CORPORATIVO */}
                    <footer className="footer">
                        <img src="./assets/logo.png" className="footer-logo" alt="logo" />
                        <div className="footer-text">Â© 2025 UTNG - TecnologÃ­as de la InformaciÃ³n. Todos los derechos reservados.</div>
                        <div className="footer-links">
                            <a href="#">PolÃ­tica de Privacidad</a>
                            <a href="#">TÃ©rminos de Servicio</a>
                            <a href="#">Soporte IT</a>
                            <a href="#">Portal Institucional</a>
                        </div>
                    </footer>

                    <div className="mobile-footer">
                        <button onClick={handleDownload} disabled={isInstalling} className={`btn-install ${installed ? 'btn-secondary' : 'btn-primary'}`}>
                            {/* ðŸŸ¢ TEXTO ACTUALIZADO */}
                            {isInstalling ? 'Descargando...' : 'Descargar'}
                        </button>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>